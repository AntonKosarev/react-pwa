/*!
 * PSPDFKit for Web 2021.2.0 (https://pspdfkit.com/web)
 * 
 * Copyright (c) 2016-2019 PSPDFKit GmbH. All rights reserved.
 * 
 * THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
 * AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
 * UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
 * This notice may not be removed from this file.
 * 
 * PSPDFKit uses several open source third-party components: https://pspdfkit.com/acknowledgements/web/
 */
(window.__PSPDFKitChunk=window.__PSPDFKitChunk||[]).push([[61],{955:function(t,e,n){"use strict";n.r(e),n.d(e,"RESTProvider",(function(){return D}));var r=n(35),a=n.n(r),o=n(91),s=n.n(o),i=n(8),c=n.n(i),u=n(17),l=n.n(u),f=n(7),d=n.n(f),h=n(13),p=n.n(h),k=n(1),y=n.n(k),b=n(57),m=n(156),v=n(3),w=n(6),P=n(9),O=n.n(P),j=n(10),x=n.n(j),F=n(4),_=n.n(F);function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=_()(t);if(e){var a=_()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return x()(this,n)}}var L=function(t){O()(n,t);var e=g(n);function n(){return d()(this,n),e.apply(this,arguments)}return n}(Object(w.e)({alreadyLoadedPages:Object(w.b)(),serverURL:null,authPayload:null,isLoaded:!1,isFormsEnabled:!0,loadBookmarksPromise:null})),S=n(204),C=n(282);function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var D=function(){function t(e,n,r){var a=r.isFormsEnabled;d()(this,t),y()(this,"canCreateBackendOrphanWidgets",!0),y()(this,"setDocumentHandleConflictCallback",(function(){})),this.state=new L({serverURL:e,authPayload:n,isFormsEnabled:a})}var e,n,r,o,i,u,f,h,k,P,O,j,x,F;return p()(t,[{key:"load",value:(F=l()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state=this.state.set("isLoaded",!0),!this.state.isFormsEnabled){t.next=4;break}return t.next=4,this._initializeFormFieldValues();case 4:return t.abrupt("return",this);case 5:case"end":return t.stop()}}),t,this)}))),function(){return F.apply(this,arguments)})},{key:"destroy",value:function(){}},{key:"setReadStateCallbacks",value:function(t){this._readStateCallbacks=t}},{key:"setAnnotationCallbacks",value:function(t){this.annotationCallbacks=t}},{key:"setBookmarkCallbacks",value:function(t){this.bookmarkCallbacks=t}},{key:"setFormFieldValueCallbacks",value:function(t){this.formFieldValueCallbacks=t}},{key:"createAnnotation",value:(x=l()(c.a.mark((function t(e,n){var r,a,o,i,u=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._verifyLoaded(),r=Object(b.o)(e),a=r.id,o=s()(r,["id"]),i={id:a,content:o},t.next=5,this._request("/annotations","POST",i).then((function(t){if(200!==t.status)throw new v.a("PSPDFKit Server returned an error, when saving an annotation.");t.json().then((function(t){if("attachment_missing"===t.error){var e=B(i,n);return u._request("/annotations","POST",e).then((function(t){return t.json()}))}return t}))}));case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return x.apply(this,arguments)})},{key:"updateAnnotation",value:(j=l()(c.a.mark((function t(e){var n,r,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._verifyLoaded(),n=Object(b.o)(e),r=n.id,a=s()(n,["id"]),t.next=4,this._request("/annotations/".concat(r),"PUT",{id:r,content:a});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return j.apply(this,arguments)})},{key:"deleteAnnotation",value:(O=l()(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._verifyLoaded(),t.next=3,this._request("/annotations/".concat(e.id),"DELETE");case 3:case"end":return t.stop()}}),t,this)}))),function(t){return O.apply(this,arguments)})},{key:"createBookmark",value:(P=l()(c.a.mark((function t(e){var n,r,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._verifyLoaded(),t.next=3,this.loadBookmarks();case 3:return n=Object(m.b)(e),r=n.id,a=s()(n,["id"]),t.next=6,this._request("/bookmarks","POST",{id:r,content:a});case 6:if(200===t.sent.status){t.next=9;break}throw new v.a("PSPDFKit Server returned an error, when saving an bookmark.");case 9:case"end":return t.stop()}}),t,this)}))),function(t){return P.apply(this,arguments)})},{key:"updateBookmark",value:(k=l()(c.a.mark((function t(e){var n,r,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._verifyLoaded(),t.next=3,this.loadBookmarks();case 3:return n=Object(m.b)(e),r=n.id,a=s()(n,["id"]),t.next=6,this._request("/bookmarks/".concat(r),"PUT",{id:r,content:a});case 6:case"end":return t.stop()}}),t,this)}))),function(t){return k.apply(this,arguments)})},{key:"deleteBookmark",value:(h=l()(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._verifyLoaded(),t.next=3,this.loadBookmarks();case 3:return t.next=5,this._request("/bookmarks/".concat(e),"DELETE");case 5:case"end":return t.stop()}}),t,this)}))),function(t){return h.apply(this,arguments)})},{key:"setFormFieldValue",value:(f=l()(c.a.mark((function t(e){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._verifyLoaded(),n={id:Object(S.b)(e),content:Object(b.s)(e)},t.next=4,this._request("/form-field-values","POST",{formFieldValues:[n]});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return f.apply(this,arguments)})},{key:"createFormFieldValue",value:(u=l()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return");case 1:case"end":return t.stop()}}),t)}))),function(){return u.apply(this,arguments)})},{key:"deleteFormFieldValue",value:(i=l()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return");case 1:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"loadAnnotationsForPageIndex",value:(o=l()(c.a.mark((function t(e){var n,r,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._verifyLoaded(),!this.state.alreadyLoadedPages.has(e)){t.next=5;break}return t.next=4,this.state.alreadyLoadedPages.get(e);case 4:return t.abrupt("return");case 5:return t.prev=5,n=this._request("/page-".concat(e,"-annotations"),"GET").then((function(t){return t.json()})).catch((function(t){throw t})),this.state=this.state.setIn(["alreadyLoadedPages",e],n),t.next=10,n;case 10:r=t.sent,this.state=this.state.setIn(["alreadyLoadedPages",e],Promise.resolve()),(a=Object(w.a)().withMutations((function(t){r.annotations.map((function(e){try{t.push(Object(b.c)(e.id,e.content))}catch(t){console.info("Skipped creating annotation #".concat(e.id," from payload because an error occurred while deserializing."),e.content),console.info(t)}}))}))).size>0&&(Object(v.i)(this.annotationCallbacks),this.annotationCallbacks.createAnnotations(a,Object(w.b)(),C.a)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(5),this._handleError(t.t0,"annotations");case 19:case"end":return t.stop()}}),t,this,[[5,16]])}))),function(t){return o.apply(this,arguments)})},{key:"loadBookmarks",value:(r=l()(c.a.mark((function t(){var e,n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._verifyLoaded(),!this.state.loadBookmarksPromise){t.next=5;break}return t.next=4,this.state.loadBookmarksPromise;case 4:return t.abrupt("return");case 5:return t.prev=5,e=this._request("/bookmarks","GET").then((function(t){return t.json()})).then((function(t){return t.data})).catch((function(t){throw t})),this.state=this.state.set("loadBookmarksPromise",e),t.next=10,e;case 10:n=t.sent,this.state=this.state.set("loadBookmarksPromise",Promise.resolve()),Object(v.i)(Array.isArray(n.bookmarks),"Unexpected reply from bookmarks endpoint."),(r=Object(w.a)().withMutations((function(t){n.bookmarks.forEach((function(e){try{t.push(Object(m.a)(e.id,e.content))}catch(t){console.info("Skipped creating bookmark #".concat(e.id," from payload because an error occurred while deserializing."),e),console.info(t)}}))}))).size>0&&(Object(v.i)(this.bookmarkCallbacks),this.bookmarkCallbacks.createBookmarks(r,C.a)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),this._handleError(t.t0,"bookmarks");case 20:case"end":return t.stop()}}),t,this,[[5,17]])}))),function(){return r.apply(this,arguments)})},{key:"syncChanges",value:(n=l()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"_initializeFormFieldValues",value:(e=l()(c.a.mark((function t(){var e,n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._request("/form-field-values","GET");case 2:return e=t.sent,t.next=5,e.json();case 5:n=t.sent,Object(v.i)(Array.isArray(n.formFieldValues),"Unexpected reply from form-values endpoint."),r=Object(w.a)(n.formFieldValues.map((function(t){var e=t.content;try{return Object(b.f)(e)}catch(t){return console.info("Skipped form field value ".concat(e.name," from payload because an error occurred while deserializing."),e),console.info(t),null}})).filter(Boolean)),Object(v.i)(this.formFieldValueCallbacks),this.formFieldValueCallbacks.setFormFieldValues(r);case 10:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"_handleError",value:function(t,e){Object(v.h)("Loading or updating ".concat(e," failed:\n\n").concat(t.message))}},{key:"_request",value:function(t,e,n){Object(v.i)(null!=this.state.authPayload,"Cannot call request without authPayload");var r=n instanceof FormData||"object"!==a()(n)?null:{"Content-Type":"application/json"},o=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){y()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({"X-PSPDFKit-Token":this.state.authPayload.token,"PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(4,", client=").concat("2021.2.0",", client-git=").concat("091d06432f")},r);return fetch("".concat(this.state.serverURL).concat(t),{method:e,headers:o,body:n instanceof FormData?n:"object"===a()(n)?JSON.stringify(n):void 0,credentials:"include"})}},{key:"_verifyLoaded",value:function(){if(!this.state.isLoaded)throw new Error("not loaded")}}]),t}();function B(t,e){var n=new FormData;return n.append("annotation",JSON.stringify(t)),e.forEach((function(t,e){e&&t.data&&n.append(e,t.data)})),n}}}]);